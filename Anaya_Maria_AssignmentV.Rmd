---
title: "Assignment V"
author: "Maria Anaya"
output: html_document
---

## 1. Setting up a new GitHub repository

A GitHub repository has been set up under the following link: https://github.com/maria-anaya/AssignmentV.git.


## 2. Getting to know the API

We can get the information of the following tables thanks to API: products, offers, events, attractions, areas, passwords, images, segments, venues, price-zones, prices, genres and sub-genres.
Filters can be applied. 

The rate limit is of 5000 calls of API per day and 5 requests per second.

In order to keep the key API secret, it is saved within another script


```{r 2API}
rm(list = ls())

# API key stored in another source
source('~/AssignmentV/script key.R')

```

## 3. Interacting with the API - the basics

Before going ahead,we check if the request has been successful by checking its status. When aplying the function content(), we can see the structure of the elements (embedded, venues, name, etc), for each event venue. Once we also apply the function fromJSON(), we get different lists contained embedded, pages and links.

```{r 3APIBasics,warning=FALSE,error=FALSE,message=FALSE}

# Loading packages needed
library(httr)
library(tibble)
library(dplyr)
library(rlist)
library(tidyverse)
library(ggplot2)



# GET request with everything 
EventGermany<- GET(url="https://app.ticketmaster.com/discovery/v2/venues.json?",
                                 query=list(apikey=KeyAPI,
                                            countryCode="DE",
                                            locale="*"
                                            ))


# Check with status if query is successfully executed                           
status_code(EventGermany)


# Convert with content function
EventGermany_response<-content(EventGermany, as = "text", encoding = "UTF-8")


print(EventGermany)

# Convert with fromJSON function
EventGermany_response<-jsonlite::fromJSON(EventGermany_response,flatten=TRUE) 

EventGermany_response<-EventGermany_response%>%data.frame()

# Extract information 
EventGermany_response<-select(EventGermany_response,name=X_embedded.venues.name,city=X_embedded.venues.city.name,postalCode=X_embedded.venues.postalCode,address=X_embedded.venues.address.line1,url=X_embedded.venues.url,longitude=X_embedded.venues.location.longitude,latitude=X_embedded.venues.location.latitude)

# Structure of data frame obtained
glimpse(EventGermany_response)

```